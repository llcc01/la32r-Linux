From 35ce24adc4423209313bfe5bd6318f8018878b7b Mon Sep 17 00:00:00 2001
From: Fanrui Meng <mengfanrui@loongson.cn>
Date: Mon, 18 Apr 2022 11:28:25 +0800
Subject: [PATCH 43/48] LoongArch32: delete some unused code.

Del some unused include file code.

Signed-off-by: Fanrui Meng <mengfanrui@loongson.cn>
---
 arch/loongarch/include/asm/addrspace.h        |  9 +-
 arch/loongarch/include/asm/atomic.h           |  3 -
 arch/loongarch/include/asm/barrier.h          | 10 ---
 arch/loongarch/include/asm/bitops.h           |  3 -
 arch/loongarch/include/asm/loongarchregs.h    | 16 ----
 .../include/asm/mach-loongson32/irq.h         |  4 +-
 .../include/asm/mach-loongson32/loongson.h    | 82 -------------------
 arch/loongarch/include/asm/pgtable-32.h       |  2 +-
 arch/loongarch/loongson32/irq.c               | 21 +----
 9 files changed, 8 insertions(+), 142 deletions(-)

diff --git a/arch/loongarch/include/asm/addrspace.h b/arch/loongarch/include/asm/addrspace.h
index 0c7f77d9a8ab..83b38b634775 100644
--- a/arch/loongarch/include/asm/addrspace.h
+++ b/arch/loongarch/include/asm/addrspace.h
@@ -85,24 +85,19 @@ extern unsigned long vm_map_base;
  *  32/64-bit LoongArch address spaces
  */
 #ifdef __ASSEMBLY__
-#ifdef CONFIG_32BIT
 #define _ACAST32_
-#endif
-#ifdef CONFIG_64BIT
+#ifndef CONFIG_32BIT
 #define _ACAST64_
 #endif
 
 #else
-#ifdef CONFIG_32BIT
 #define _ACAST32_		(_ATYPE_)(_ATYPE32_)	/* widen if necessary */
-#endif
-#ifdef CONFIG_64BIT
+#ifndef CONFIG_32BIT
 #define _ACAST64_		(_ATYPE64_)		/* do _not_ narrow */
 #endif
 #endif
 
 #ifdef CONFIG_32BIT
-#define MAP_BASE                _AC(0xc0000000, UL)
 #define UVRANGE			0x00000000
 #define KPRANGE0		0x80000000
 #define KPRANGE1		0xa0000000
diff --git a/arch/loongarch/include/asm/atomic.h b/arch/loongarch/include/asm/atomic.h
index f2b737b15edb..d4ad7385e5e9 100644
--- a/arch/loongarch/include/asm/atomic.h
+++ b/arch/loongarch/include/asm/atomic.h
@@ -77,7 +77,6 @@ static inline int arch_atomic_fetch_##op##_relaxed(int i, atomic_t *v)	\
 static __inline__ void arch_atomic_##op(int i, atomic_t * v)                 \
 {                                                                       \
         int temp ;                                              \
-        loongson_llsc_mb();                                     \
         __asm__ __volatile__(                                   \
         "1:     ll.w        %0, %1      #atomic_" #op "  \n"    \
         "       " #asm_op " %0, %0, %2                   \n"    \
@@ -94,7 +93,6 @@ static __inline__ int arch_atomic_##op##_return_relaxed(int i, atomic_t * v)
         int result;                                                           \
         int temp;                                                             \
                                                                               \
-        loongson_llsc_mb();                                                   \
         __asm__ __volatile__(                                                 \
                 "1:     ll.w    %1, %2          # atomic_" #op "_return \n"   \
                 "       " #asm_op " %0, %1, %3                          \n"   \
@@ -113,7 +111,6 @@ static __inline__ int arch_atomic_fetch_##op##_relaxed(int i, atomic_t * v)
         int result;                                                           \
         int temp;                                                     \
                                                                       \
-        loongson_llsc_mb();                                           \
         __asm__ __volatile__(                                         \
         "1:     ll.w    %1, %2          # atomic_fetch_" #op "  \n"   \
         "       " #asm_op " %0, %1, %3                          \n"   \
diff --git a/arch/loongarch/include/asm/barrier.h b/arch/loongarch/include/asm/barrier.h
index 488d4a7a16d1..028f8a668c17 100644
--- a/arch/loongarch/include/asm/barrier.h
+++ b/arch/loongarch/include/asm/barrier.h
@@ -33,16 +33,6 @@
 #define __smp_mb__before_atomic()	barrier()
 #define __smp_mb__after_atomic()	__smp_mb()
 
-
-#ifdef CONFIG_CPU_LOONGSON3_WORKAROUNDS /* Loongson-3's LLSC workaround */
-#define loongson_llsc_mb()      __asm__ __volatile__(__WEAK_LLSC_MB : : :"memory")
-#else
-#define loongson_llsc_mb()      do { } while (0)
-#endif
-
-
-
-
 /**
  * array_index_mask_nospec() - generate a ~0 mask when index < size, 0 otherwise
  * @index: array element index
diff --git a/arch/loongarch/include/asm/bitops.h b/arch/loongarch/include/asm/bitops.h
index 036e8fb8ab4e..6bae2b457268 100644
--- a/arch/loongarch/include/asm/bitops.h
+++ b/arch/loongarch/include/asm/bitops.h
@@ -59,7 +59,6 @@ static inline void set_bit(unsigned long nr, volatile unsigned long *addr)
 	: "r" (1UL << bit)
 	: "memory");
 #else
-	loongson_llsc_mb();
 	__asm__ __volatile__(
 	"1:     " __LL "%0, %1                  \n"
 	"       or      %0, %0, %2                      \n"
@@ -94,7 +93,6 @@ static inline void clear_bit(unsigned long nr, volatile unsigned long *addr)
 	: "r" (~(1UL << bit))
 	: "memory");
 #else
-        loongson_llsc_mb();
         __asm__ __volatile__(
         "1:     " __LL "%0, %1                  \n"
         "       and     %0, %0, %2                      \n"
@@ -142,7 +140,6 @@ static inline void change_bit(unsigned long nr, volatile unsigned long *addr)
 	: "r" (1UL << bit)
 	: "memory");
 #else
-	loongson_llsc_mb();
 	__asm__ __volatile__(
 	"1:     "__LL "%0, %1           \n"
 	"       xor     %0, %0, %2      \n"
diff --git a/arch/loongarch/include/asm/loongarchregs.h b/arch/loongarch/include/asm/loongarchregs.h
index efa8919f17e9..a5d836d4c2af 100644
--- a/arch/loongarch/include/asm/loongarchregs.h
+++ b/arch/loongarch/include/asm/loongarchregs.h
@@ -1444,22 +1444,6 @@ static inline void write_csr_pagesize(unsigned int size)
 #define write_csr_impctl1(val)		__csrwr(val, LOONGARCH_CSR_IMPCTL1)
 #define write_csr_impctl2(val)		__csrwr(val, LOONGARCH_CSR_IMPCTL2)
 
-#define read_csr_perfctrl0()		__csrrd(LOONGARCH_CSR_PERFCTRL0)
-#define read_csr_perfcntr0()		__csrrd(LOONGARCH_CSR_PERFCNTR0)
-#define read_csr_perfctrl1()		__csrrd(LOONGARCH_CSR_PERFCTRL1)
-#define read_csr_perfcntr1()		__csrrd(LOONGARCH_CSR_PERFCNTR1)
-#define read_csr_perfctrl2()		__csrrd(LOONGARCH_CSR_PERFCTRL2)
-#define read_csr_perfcntr2()		__csrrd(LOONGARCH_CSR_PERFCNTR2)
-#define read_csr_perfctrl3()		__csrrd(LOONGARCH_CSR_PERFCTRL3)
-#define read_csr_perfcntr3()		__csrrd(LOONGARCH_CSR_PERFCNTR3)
-#define write_csr_perfctrl0(val)	__csrwr(val, LOONGARCH_CSR_PERFCTRL0)
-#define write_csr_perfcntr0(val)	__csrwr(val, LOONGARCH_CSR_PERFCNTR0)
-#define write_csr_perfctrl1(val)	__csrwr(val, LOONGARCH_CSR_PERFCTRL1)
-#define write_csr_perfcntr1(val)	__csrwr(val, LOONGARCH_CSR_PERFCNTR1)
-#define write_csr_perfctrl2(val)	__csrwr(val, LOONGARCH_CSR_PERFCTRL2)
-#define write_csr_perfcntr2(val)	__csrwr(val, LOONGARCH_CSR_PERFCNTR2)
-#define write_csr_perfctrl3(val)	__csrwr(val, LOONGARCH_CSR_PERFCTRL3)
-#define write_csr_perfcntr3(val)	__csrwr(val, LOONGARCH_CSR_PERFCNTR3)
 #endif
 
 /*
diff --git a/arch/loongarch/include/asm/mach-loongson32/irq.h b/arch/loongarch/include/asm/mach-loongson32/irq.h
index a4c9e25e1af9..3e12423c0c14 100644
--- a/arch/loongarch/include/asm/mach-loongson32/irq.h
+++ b/arch/loongarch/include/asm/mach-loongson32/irq.h
@@ -14,8 +14,8 @@
 #define LOONGSON_LPC_LAST_IRQ		(LOONGSON_LPC_IRQ_BASE + 15)
 
 #define LOONGSON_CPU_IRQ_BASE		16
-#define LOONGSON_LINTC_IRQ		(LOONGSON_CPU_IRQ_BASE + 2) /* IP2 for CPU local interrupt controller */
-#define LOONGSON_BRIDGE_IRQ		(LOONGSON_CPU_IRQ_BASE + 3) /* IP3 for bridge */
+#define LOONGSON_UART_IRQ		(LOONGSON_CPU_IRQ_BASE + 2) /* IP2 for CPU local interrupt controller */
+#define LOONGSON_GMAC_IRQ		(LOONGSON_CPU_IRQ_BASE + 3) /* IP3 for bridge */
 #define LOONGSON_TIMER_IRQ		(LOONGSON_CPU_IRQ_BASE + 11) /* IP11 CPU Timer */
 #define LOONGSON_CPU_LAST_IRQ		(LOONGSON_CPU_IRQ_BASE + 14)
 
diff --git a/arch/loongarch/include/asm/mach-loongson32/loongson.h b/arch/loongarch/include/asm/mach-loongson32/loongson.h
index 0878709b534a..1c150d4990a8 100644
--- a/arch/loongarch/include/asm/mach-loongson32/loongson.h
+++ b/arch/loongarch/include/asm/mach-loongson32/loongson.h
@@ -80,86 +80,4 @@ static inline void xconf_writeq(u64 val64, volatile void __iomem *addr)
 	);
 }
 
-/* ============== LS7A registers =============== */
-#define LS7A_PCH_REG_BASE		0x10000000UL
-/* LPC regs */
-#define LS7A_LPC_REG_BASE		(LS7A_PCH_REG_BASE + 0x00002000)
-/* CHIPCFG regs */
-#define LS7A_CHIPCFG_REG_BASE		(LS7A_PCH_REG_BASE + 0x00010000)
-/* MISC reg base */
-#define LS7A_MISC_REG_BASE		(LS7A_PCH_REG_BASE + 0x00080000)
-/* ACPI regs */
-#define LS7A_ACPI_REG_BASE		(LS7A_MISC_REG_BASE + 0x00050000)
-/* RTC regs */
-#define LS7A_RTC_REG_BASE		(LS7A_MISC_REG_BASE + 0x00050100)
-
-#define LS7A_DMA_CFG			(volatile void *)TO_UNCAC(LS7A_CHIPCFG_REG_BASE + 0x041c)
-#define LS7A_DMA_NODE_SHF		8
-#define LS7A_DMA_NODE_MASK		0x1F00
-
-#define LS7A_INT_MASK_REG		(volatile void *)TO_UNCAC(LS7A_PCH_REG_BASE + 0x020)
-#define LS7A_INT_EDGE_REG		(volatile void *)TO_UNCAC(LS7A_PCH_REG_BASE + 0x060)
-#define LS7A_INT_CLEAR_REG		(volatile void *)TO_UNCAC(LS7A_PCH_REG_BASE + 0x080)
-#define LS7A_INT_HTMSI_EN_REG		(volatile void *)TO_UNCAC(LS7A_PCH_REG_BASE + 0x040)
-#define LS7A_INT_ROUTE_ENTRY_REG	(volatile void *)TO_UNCAC(LS7A_PCH_REG_BASE + 0x100)
-#define LS7A_INT_HTMSI_VEC_REG		(volatile void *)TO_UNCAC(LS7A_PCH_REG_BASE + 0x200)
-#define LS7A_INT_STATUS_REG		(volatile void *)TO_UNCAC(LS7A_PCH_REG_BASE + 0x3a0)
-#define LS7A_INT_POL_REG		(volatile void *)TO_UNCAC(LS7A_PCH_REG_BASE + 0x3e0)
-#define LS7A_LPC_INT_CTL		(volatile void *)TO_UNCAC(LS7A_PCH_REG_BASE + 0x2000)
-#define LS7A_LPC_INT_ENA		(volatile void *)TO_UNCAC(LS7A_PCH_REG_BASE + 0x2004)
-#define LS7A_LPC_INT_STS		(volatile void *)TO_UNCAC(LS7A_PCH_REG_BASE + 0x2008)
-#define LS7A_LPC_INT_CLR		(volatile void *)TO_UNCAC(LS7A_PCH_REG_BASE + 0x200c)
-#define LS7A_LPC_INT_POL		(volatile void *)TO_UNCAC(LS7A_PCH_REG_BASE + 0x2010)
-
-#define LS7A_PMCON_SOC_REG		(volatile void *)TO_UNCAC(LS7A_ACPI_REG_BASE + 0x000)
-#define LS7A_PMCON_RESUME_REG		(volatile void *)TO_UNCAC(LS7A_ACPI_REG_BASE + 0x004)
-#define LS7A_PMCON_RTC_REG		(volatile void *)TO_UNCAC(LS7A_ACPI_REG_BASE + 0x008)
-#define LS7A_PM1_EVT_REG		(volatile void *)TO_UNCAC(LS7A_ACPI_REG_BASE + 0x00c)
-#define LS7A_PM1_ENA_REG		(volatile void *)TO_UNCAC(LS7A_ACPI_REG_BASE + 0x010)
-#define LS7A_PM1_CNT_REG		(volatile void *)TO_UNCAC(LS7A_ACPI_REG_BASE + 0x014)
-#define LS7A_PM1_TMR_REG		(volatile void *)TO_UNCAC(LS7A_ACPI_REG_BASE + 0x018)
-#define LS7A_P_CNT_REG			(volatile void *)TO_UNCAC(LS7A_ACPI_REG_BASE + 0x01c)
-#define LS7A_GPE0_STS_REG		(volatile void *)TO_UNCAC(LS7A_ACPI_REG_BASE + 0x028)
-#define LS7A_GPE0_ENA_REG		(volatile void *)TO_UNCAC(LS7A_ACPI_REG_BASE + 0x02c)
-#define LS7A_RST_CNT_REG		(volatile void *)TO_UNCAC(LS7A_ACPI_REG_BASE + 0x030)
-#define LS7A_WD_SET_REG			(volatile void *)TO_UNCAC(LS7A_ACPI_REG_BASE + 0x034)
-#define LS7A_WD_TIMER_REG		(volatile void *)TO_UNCAC(LS7A_ACPI_REG_BASE + 0x038)
-#define LS7A_THSENS_CNT_REG		(volatile void *)TO_UNCAC(LS7A_ACPI_REG_BASE + 0x04c)
-#define LS7A_GEN_RTC_1_REG		(volatile void *)TO_UNCAC(LS7A_ACPI_REG_BASE + 0x050)
-#define LS7A_GEN_RTC_2_REG		(volatile void *)TO_UNCAC(LS7A_ACPI_REG_BASE + 0x054)
-#define LS7A_DPM_CFG_REG		(volatile void *)TO_UNCAC(LS7A_ACPI_REG_BASE + 0x400)
-#define LS7A_DPM_STS_REG		(volatile void *)TO_UNCAC(LS7A_ACPI_REG_BASE + 0x404)
-#define LS7A_DPM_CNT_REG		(volatile void *)TO_UNCAC(LS7A_ACPI_REG_BASE + 0x408)
-
-typedef enum {
-	ACPI_PCI_HOTPLUG_STATUS	= 1 << 1,
-	ACPI_CPU_HOTPLUG_STATUS	= 1 << 2,
-	ACPI_MEM_HOTPLUG_STATUS	= 1 << 3,
-	ACPI_POWERBUTTON_STATUS	= 1 << 8,
-	ACPI_RTC_WAKE_STATUS	= 1 << 10,
-	ACPI_PCI_WAKE_STATUS	= 1 << 14,
-	ACPI_ANY_WAKE_STATUS	= 1 << 15,
-} AcpiEventStatusBits;
-
-#define HT1LO_OFFSET		0xe0000000000UL
-
-/* PCI Configuration Space Base */
-#define HT1LO_PCICFG_BASE	0xefdfe000000UL
-#define HT1LO_PCICFG_BASE_TP1	0xefdff000000UL
-
-#define MCFG_EXT_PCICFG_BASE		0xefe00000000UL
-#define HT1LO_EXT_PCICFG_BASE		(((struct pci_controller *)(bus)->sysdata)->mcfg_addr)
-#define HT1LO_EXT_PCICFG_BASE_TP1	(HT1LO_EXT_PCICFG_BASE + 0x10000000)
-
-/* REG ACCESS*/
-#define ls7a_readb(addr)			  (*(volatile unsigned char  *)TO_UNCAC(addr))
-#define ls7a_readw(addr)			  (*(volatile unsigned short *)TO_UNCAC(addr))
-#define ls7a_readl(addr)			  (*(volatile unsigned int   *)TO_UNCAC(addr))
-#define ls7a_readq(addr)			  (*(volatile unsigned long  *)TO_UNCAC(addr))
-#define ls7a_writeb(val, addr)		*(volatile unsigned char  *)TO_UNCAC(addr) = (val)
-#define ls7a_writew(val, addr)		*(volatile unsigned short *)TO_UNCAC(addr) = (val)
-#define ls7a_writel(val, addr)		ls7a_write_type(val, addr, uint32_t)
-#define ls7a_writeq(val, addr)		ls7a_write_type(val, addr, uint64_t)
-#define ls7a_write(val, addr)		ls7a_write_type(val, addr, uint64_t)
-
 #endif /* __ASM_MACH_LOONGSON32_LOONGSON_H */
diff --git a/arch/loongarch/include/asm/pgtable-32.h b/arch/loongarch/include/asm/pgtable-32.h
index 250662565823..55dac1ce2bca 100644
--- a/arch/loongarch/include/asm/pgtable-32.h
+++ b/arch/loongarch/include/asm/pgtable-32.h
@@ -66,7 +66,7 @@
 #define FIRST_USER_ADDRESS	0UL
 
 #ifndef __ASSEMBLY__
-#define VMALLOC_START	  MAP_BASE
+#define VMALLOC_START _AC(0xc0000000, UL)
 #define FIXADDR_START 0xe0000000UL
 #define PKMAP_END	((FIXADDR_START) & ~((LAST_PKMAP << PAGE_SHIFT)-1))
 #define PKMAP_BASE	(PKMAP_END - PAGE_SIZE * LAST_PKMAP)
diff --git a/arch/loongarch/loongson32/irq.c b/arch/loongarch/loongson32/irq.c
index f5a907f0e60c..01ef9b69bb46 100644
--- a/arch/loongarch/loongson32/irq.c
+++ b/arch/loongarch/loongson32/irq.c
@@ -29,14 +29,14 @@ struct fwnode_handle *acpi_picdomain_handle[MAX_PCH_PICS];
 
 void mach_irq_dispatch(unsigned int pending)
 {
-        if (pending & 0x800)
+    if (pending & 0x800)
 		do_IRQ(LOONGSON_TIMER_IRQ);
 	if (pending & 0x20)
 		do_IRQ(4);
 	if (pending & 0x4)
-		do_IRQ(LOONGSON_BRIDGE_IRQ) ; //in fact , it's for ehternet
+		do_IRQ(LOONGSON_GMAC_IRQ) ; //in fact , it's for ehternet
 	if (pending & 0x8)
-		do_IRQ(LOONGSON_LINTC_IRQ);
+		do_IRQ(LOONGSON_UART_IRQ);
 }
 
 asmlinkage void plat_irq_dispatch(void)
@@ -70,27 +70,12 @@ void __init setup_IRQ(void)
 	irqchip_init();
 }
 
-static inline void mask_loongson_irq(struct irq_data *d) { }
-static inline void unmask_loongson_irq(struct irq_data *d) { }
-
-static struct irq_chip loongson_irq_chip = {
-	.name           = "Loongson",
-	.irq_ack        = mask_loongson_irq,
-	.irq_mask       = mask_loongson_irq,
-	.irq_mask_ack   = mask_loongson_irq,
-	.irq_unmask     = unmask_loongson_irq,
-	.irq_eoi        = unmask_loongson_irq,
-};
-
-
 void __init arch_init_irq(void)
 {
 	clear_csr_ecfg(ECFG0_IM);
 	clear_csr_estat(ESTATF_IP);
 
 	setup_IRQ();
-	irq_set_chip_and_handler(LOONGSON_LINTC_IRQ,
-			&loongson_irq_chip, handle_percpu_irq);
 
 	set_csr_ecfg(ECFGF_IP0 | ECFGF_IP1 |ECFGF_IP2 | ECFGF_IP3| ECFGF_IPI | ECFGF_PC);
 }
-- 
2.37.2

