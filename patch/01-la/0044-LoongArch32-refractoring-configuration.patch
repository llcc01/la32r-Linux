From ff80d6064359c297d248287e4479d2053284529c Mon Sep 17 00:00:00 2001
From: Fanrui Meng <mengfanrui@loongson.cn>
Date: Mon, 18 Apr 2022 11:43:30 +0800
Subject: [PATCH 44/48] LoongArch32 : refractoring configuration

Signed-off-by: Fanrui Meng <mengfanrui@loongson.cn>
---
 README                                        | 21 +++++++------------
 .../loongarch/configs/la32_defconfig          |  0
 la_build.sh                                   |  5 +++++
 3 files changed, 13 insertions(+), 13 deletions(-)
 rename config.back => arch/loongarch/configs/la32_defconfig (100%)

diff --git a/README b/README
index 64f46aeaf0c3..e03005b83c87 100644
--- a/README
+++ b/README
@@ -2,20 +2,15 @@
     1.进入源码目录
 	cd linux-5.14-loongarch32
 
-    1.配置la_build.sh下loongarch32工具链位置
+    2.配置la_build.sh下loongarch32工具链位置
 	vim la_build.sh
 	修改CROSS_COMPILE参数，例：CROSS_COMPILE=~/work/toolchain/install/bin/loongarch32-linux-gnu-
 
-    2.创建生成目录
-	mkdir la_build
+    3.编译好的busybox放在了initrd_pck32目录下,编译内核时需要指明其路径，修改方式有两种:
+	    3.1 修改la_build/.config文件中的CONFIG_INITRAMFS_SOURCE参数
+	    例：CONFIG_INITRAMFS_SOURCE="~/linux-5.14-loongarch32/initrd_pck32"
+        3.2 在menuconfig中"General Setup" -> "Initramfs source file(s)" 修改
+    
+    4. 执行 ./la_build.sh开始编译.
 
-    4.复制配置文件config文件到la_build目录下
-	cp config.back ./la_build/.config
-
-    5.编译好的busybox放在了initrd_pck32目录下
-	修改la_build/.config文件中的CONFIG_INITRAMFS_SOURCE参数
-	例：CONFIG_INITRAMFS_SOURCE="~/linux-5.14-loongarch32/initrd_pck32"
-
-    5. 执行 ./la_build.sh开始编译。默认打开了debug_info
-
-    6.生成的vmlinux内核位于la_build目录下
+    5.生成的vmlinux内核位于la_build目录下
diff --git a/config.back b/arch/loongarch/configs/la32_defconfig
similarity index 100%
rename from config.back
rename to arch/loongarch/configs/la32_defconfig
diff --git a/la_build.sh b/la_build.sh
index 7378468c6957..7ce234a0871d 100755
--- a/la_build.sh
+++ b/la_build.sh
@@ -4,6 +4,11 @@ export CROSS_COMPILE=~/install-32-glibc-loongarch-novec-reduce-linux-5-14/bin/lo
 export ARCH=loongarch
 OUT=la_build
 
+if [ ! -d la_build ] ;then
+    mkdir la_build
+    make la32_defconfig O=${OUT}
+fi
+
 echo "----------------output ${OUT}----------------"
 
 make menuconfig O=${OUT}
-- 
2.37.2

